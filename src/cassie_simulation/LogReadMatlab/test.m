ya2 =[     0.815262            0  -0.00563945 -5.77493e-07 -4.71999e-05    -0.269495 -5.73838e-06            0  -0.00213384];
dya2 = [  -0.0399567         0.1         0.1         0.1   0.0262039 0.000202929   -0.026933         0.1   -0.342333];
Jya2 = [            0            0            0  2.88486e-25  -0.00272552    -0.134627    0.0061109 -0.000171205   -0.0299542    0.0183676    -0.242222  6.33138e-05  -0.00584695  3.57451e-05 -0.000738242   -0.0107542   0.00283099  6.33052e-05
    0            0            0            0            0            0            0            1            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            1            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            1            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0     0.269495 -5.73838e-06   0.00151979 -1.42736e-06  -0.00449931    -0.851645    -0.746781    -0.328651            0 -1.42108e-06  -0.00449931     0.851651     0.746786     0.328671            0
    0            0            0 -4.71999e-05  1.51684e-22  5.47211e-06    -0.941807   -0.0244142  0.000110092 -0.000150303   0.00109666            0     0.941813     0.024367  0.000109908 -0.000150554   0.00109682            0
    0            0            0 -5.17661e-27  4.71999e-05    -0.269491    0.0002531 -0.000135468   -0.0292175    0.0291203    -0.245053            0  0.000251987 -0.000135283    0.0291703   -0.0291675     0.245027            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            1            0            0            0            0
    0            0            0 -1.21004e-22      1.14286  1.94455e-05            0            0            0            0            0            0  1.94455e-05    0.0051547     -1.14284     -1.14284     -1.14284     -1.14284];
dJyadq2 = [   -0.0504771            0            0            0  -0.00542296   0.00557757 -0.000114758            0   -0.0464513];
yd2 = [     0.815262            0            0            0 -4.71999e-05    -0.269495 -5.73838e-06            0            0];
dyd2 = [ 0 0 0 0 0 0 0 0 0];
d2yd2 = [        0        0        0        0  11.5736 -11.2821  22.2241        0        0];
pCOM2 =[ 0.00272328  -0.134629   0.815262];
vCOM2 = [   0.10253  0.124342 0.0999484];
Lpivot2 = [  0.105153 0.0801573];
D2 = [      33.312 -4.10149e-20  5.55112e-17  -0.00393927     -4.21959  4.27396e-06  -0.00108631    -0.184782      1.48346     0.884277     0.161606   0.00360574   0.00111258     0.184782      1.48345     0.884262     0.161614   0.00360591
    -4.10149e-20       33.312 -3.38813e-21    -0.551259  2.64896e-05      4.21641      2.25495   -0.0329076  0.000139084   0.00163214 -0.000422216 -9.44151e-06      2.25494   -0.0329589 -0.000157969  -0.00164388  0.000420236  9.39735e-06
    5.55112e-17 -3.38813e-21       33.312 -3.38813e-21     0.551259   0.00393575     0.195135  -0.00119048   -0.0245433    -0.358194     0.094319   0.00210911    -0.194774   0.00119074   -0.0245923    -0.358243     0.094306   0.00210882
    -0.00393927    -0.551259 -3.38813e-21     0.874558 -0.000522005    -0.432142    -0.210137     0.116305    -0.207389    -0.116725     -0.02124 -0.000488781    -0.210168     0.116317     0.207388     0.116723    0.0212411  0.000488807
    -4.21959  2.64896e-05     0.551259 -0.000522005      2.38826 -0.000166514   0.00346649    0.0192472     -0.91555    -0.713162    -0.140979  -0.00380479  -0.00345808    -0.019247    -0.915547    -0.713164    -0.140983  -0.00380488
    4.27396e-06      4.21641   0.00393575    -0.432142 -0.000166514      2.73041      1.08242    -0.105744   0.00212867   -0.0473591    0.0118979  0.000271572      1.08235    -0.105776  -0.00212239    0.0473654   -0.0118963 -0.000271534
    -0.00108631      2.25495     0.195135    -0.210137   0.00346649      1.08242       1.0942    -0.105724   0.00657135   0.00166957 -0.000711881  -1.0408e-05            0            0            0            0            0            0
    -0.184782   -0.0329076  -0.00119048     0.116305    0.0192472    -0.105744    -0.105724     0.128382  -0.00303025    0.0058594    0.0012166  1.52097e-05            0            0            0            0            0            0
    1.48346  0.000139084   -0.0245433    -0.207389     -0.91555   0.00212867   0.00657135  -0.00303025     0.873903     0.615945      0.13096   0.00358153            0            0            0            0            0            0
    0.884277   0.00163214    -0.358194    -0.116725    -0.713162   -0.0473591   0.00166957    0.0058594     0.615945     0.637552     0.108511   0.00308037            0            0            0            0            0            0
    0.161606 -0.000422216     0.094319     -0.02124    -0.140979    0.0118979 -0.000711881    0.0012166      0.13096     0.108511    0.0667985   0.00215098            0            0            0            0            0            0
    0.00360574 -9.44151e-06   0.00210911 -0.000488781  -0.00380479  0.000271572  -1.0408e-05  1.52097e-05   0.00358153   0.00308037   0.00215098    0.0126991            0            0            0            0            0            0
    0.00111258      2.25494    -0.194774    -0.210168  -0.00345808      1.08235            0            0            0            0            0            0      1.09418    -0.105756  -0.00657168   -0.0016699  0.000711783  1.04068e-05
    0.184782   -0.0329589   0.00119074     0.116317    -0.019247    -0.105776            0            0            0            0            0            0    -0.105756     0.128392   0.00303031  -0.00585934  -0.00121666 -1.52105e-05
    1.48345 -0.000157969   -0.0245923     0.207388    -0.915547  -0.00212239            0            0            0            0            0            0  -0.00657168   0.00303031     0.873899     0.615946     0.130962   0.00358159
    0.884262  -0.00164388    -0.358243     0.116723    -0.713164    0.0473654            0            0            0            0            0            0   -0.0016699  -0.00585934     0.615946     0.637557     0.108513   0.00308043
    0.161614  0.000420236     0.094306    0.0212411    -0.140983   -0.0118963            0            0            0            0            0            0  0.000711783  -0.00121666     0.130962     0.108513    0.0667985   0.00215098
    0.00360591  9.39735e-06   0.00210882  0.000488807  -0.00380488 -0.000271534            0            0            0            0            0            0  1.04068e-05 -1.52105e-05   0.00358159   0.00308043   0.00215098    0.0126991];
C2 = [   -0.16162
    0.142139
    327.006
    -0.044258
    5.49565
    0.144986
    1.96053
    -0.0245536
    -0.267161
    -3.54049
    0.924838
    0.0206646
    -1.85103
    -0.00208207
    -0.27642
    -3.54553
    0.923925
    0.0206427];
B2 = [0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0
    1 0 0 0 0 0 0 0 0 0
    0 1 0 0 0 0 0 0 0 0
    0 0 1 0 0 0 0 0 0 0
    0 0 0 1 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 0
    0 0 0 0 1 0 0 0 0 0
    0 0 0 0 0 1 0 0 0 0
    0 0 0 0 0 0 1 0 0 0
    0 0 0 0 0 0 0 1 0 0
    0 0 0 0 0 0 0 0 1 0
    0 0 0 0 0 0 0 0 0 0
    0 0 0 0 0 0 0 0 0 1];




%%%
Ay = zeros(9,34);
Ay(1:9,1:18) = Jya2;
Kp = [550,    200,           200,         200,        300,         300,         200,          200,         500];
Kd = [  10,     10,            10,          10,        10,          10,          10,            10,           10];
by = dJyadq2' - d2yd2' + Kp'.*(ya2 - yd2)' + Kd'.*(dya2 - dyd2)';
H = Ay'*Ay;
f = Ay'*by;


G = [           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0    0.0726275 -1.54646e-06  0.000409577  4.40685e-05  -0.00121139    -0.229514    -0.201254   -0.0885699  1.82652e-29 -4.48364e-05  -0.00121369     0.229516     0.201255    0.0885751  1.38289e-22            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0 -1.54646e-06      2.30613  0.000376422 -1.66434e-05  4.86048e-07  8.51489e-05 -4.44016e-05  0.000650501 -1.72563e-07  3.81713e-05   0.00589099     -1.30611     -1.30608      -1.3061      -1.3061            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0  0.000409577  0.000376422      1.09075 -0.000896054  5.25845e-05    0.0106121   -0.0114554    0.0981496 -8.52372e-06  0.000724399  2.50409e-05  -0.00648962    0.0104209   -0.0659363 -3.07458e-05            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0  4.40685e-05 -1.66434e-05 -0.000896054     0.887038    0.0229924 -0.000292913  0.000262235  -0.00257459  3.86905e-07    -0.887042   -0.0229488 -0.000101856  6.76269e-05 -0.000954145  3.86852e-07            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0  -0.00121139  4.86048e-07  5.25845e-05    0.0229924      1.00062   0.00383821   0.00335658    0.0015266 -1.08397e-08   -0.0229927 -0.000574645  -0.00383835  -0.00335055  -0.00153925 -1.08382e-08            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0    -0.229514  8.51489e-05    0.0106121 -0.000292913   0.00383821     0.727051     0.634591      0.29431 -1.89652e-06  0.000272675   0.00383738    -0.726135    -0.634823    -0.287155 -1.89626e-06            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0    -0.201254 -4.44016e-05   -0.0114554  0.000262235   0.00335658     0.634591     0.558867     0.233845  1.16292e-06 -0.000240552   0.00335305    -0.635161    -0.558732    -0.238258  1.16277e-06            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0   -0.0885699  0.000650501    0.0981496  -0.00257459    0.0015266      0.29431     0.233845     0.226735  -1.5336e-05   0.00238782   0.00152992    -0.286866     -0.23568    -0.168747 -1.53339e-05            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0  1.82652e-29 -1.72563e-07 -8.52372e-06  3.86905e-07 -1.08397e-08 -1.89652e-06  1.16292e-06  -1.5336e-05  4.00864e-09 -3.70193e-07  2.26316e-09 -4.67409e-08 -6.80889e-07  1.79241e-07  4.00809e-09            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0 -4.48364e-05  3.81713e-05  0.000724399    -0.887042   -0.0229927  0.000272675 -0.000240552   0.00238782 -3.70193e-07     0.887046     0.022949  9.17459e-05 -0.000109549    0.0010555 -2.25933e-05            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0  -0.00121369   0.00589099  2.50409e-05   -0.0229488 -0.000574645   0.00383738   0.00335305   0.00152992  2.26316e-09     0.022949      1.00064  -0.00972415  -0.00925114  -0.00737612  -0.00589101            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0     0.229516     -1.30611  -0.00648962 -0.000101856  -0.00383835    -0.726135    -0.635161    -0.286866 -4.67409e-08  9.17459e-05  -0.00972415      2.03225      1.94125      1.59315      1.30609            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0     0.201255     -1.30608    0.0104209  6.76269e-05  -0.00335055    -0.634823    -0.558732     -0.23568 -6.80889e-07 -0.000109549  -0.00925114      1.94125      1.86475      1.54436      1.30609            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0    0.0885751      -1.3061   -0.0659363 -0.000954145  -0.00153925    -0.287155    -0.238258    -0.168747  1.79241e-07    0.0010555  -0.00737612      1.59315      1.54436      1.47416      1.30609            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0  1.38289e-22      -1.3061 -3.07458e-05  3.86852e-07 -1.08382e-08 -1.89626e-06  1.16277e-06 -1.53339e-05  4.00809e-09 -2.25933e-05  -0.00589101      1.30609      1.30609      1.30609      1.30609            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0];
g = [          0           0           0    -3.05041    -5.31245     7.10506    -10.6411    0.778414       10.31     7.78635     9.35287 -2.8494e-05     10.6297     1.30566    -5.10799    -2.60744    -4.03527     5.18471           0           0           0           0           0           0           0           0           0           0           0           0           0           0           0           0];

bub_fric = [-100    0    0    0    0    0    0    0    0];


%%

J_hol = [           0            0            0            0 -1.38778e-16 -5.82759e-18 -5.84114e-18            0  2.77556e-16     0.106291     0.106294            0            0            0            0            0            0            0
    0            0            0            0  1.94289e-16 -1.73472e-17            0            0            0            0            0            0 -1.73472e-17 -6.93889e-18 -2.15336e-16     0.106293     0.106297            0
    1            0            0    -0.134994    -0.996706 -0.000755033  6.28881e-06   0.00449912      0.90642     0.801556     0.383426     0.053842            0            0            0            0            0            0
    0            1            0  -0.00113286  6.25709e-06     0.996683     0.996683     0.042245 -0.000196188  6.48651e-05  -0.00117947 -8.64318e-05            0            0            0            0            0            0
    0            0            1            0    0.0011337     0.134992 -5.64924e-06  0.000215872    0.0473575   -0.0109803     0.263193    0.0193962            0            0            0            0            0            0
    0            0            0            0            1 -3.38637e-05 -3.38637e-05  -0.00450912     -0.99999     -0.99999     -0.99999     -0.99999            0            0            0            0            0            0
    0            0            0            1  6.33389e-08   0.00750977   0.00750977     0.999963  -0.00450925  -0.00450925  -0.00450925  -0.00450925            0            0            0            0            0            0];
dJ_holdq = [-9.69971e-08 -9.65957e-08    -0.035641    0.0410933    0.0472649   -0.0398829   -0.0799181];


J_hol2 = [           0            0            0  2.43396e-23 -2.77556e-17            0            0 -1.26852e-17 -5.55112e-17     0.106401     0.106615            0            0            0            0            0            0            0
    0            0            0  2.43395e-23 -2.77556e-17            0            0            0            0            0            0            0 -6.93889e-18  1.63715e-17            0     0.106401     0.106611            0
    1  1.03723e-05 -1.09821e-27    -0.135004    -0.998736 -0.000744717  1.66048e-05   0.00449884     0.908451     0.803586     0.385456    0.0568052            0            0            0            0            0            0
    -1.03723e-05            1 -1.05879e-22    0.0808391   1.6629e-05     0.999176     0.999176     0.124202 -0.000575197 -0.000313056  -0.00155305 -0.000450924            0            0            0            0            0            0
    0 -9.26442e-23            1  8.55903e-24   -0.0808369     0.135003  5.58968e-06  0.000585439     0.129327    0.0709894     0.345163      0.10011            0            0            0            0            0            0
    -1.03723e-05            1 -1.05879e-22   -0.0791605  1.66342e-05     0.998585     0.998585   -0.0357953  0.000146282  0.000408423 -0.000831574  0.000270555            0            0            0            0            0            0
    0 -9.26442e-23            1  -8.3816e-24    0.0791628     0.135001  2.92572e-06 -0.000136033   -0.0306708   -0.0890086     0.185165   -0.0598883            0            0            0            0            0            0];
dJ_holdq2 = [0.00114787
    0.00114795
    -0.0575713
    0.0380745
    0.0682753
    0.0636746
    0.0620041];







J_hol3 = J_hol2;
dJ_holdq3 = dJ_holdq2;
J_hol3(6,:) = (J_hol2(7,:)-J_hol2(5,:))/0.16;
J_hol3(7,:) = (J_hol2(4,:)-J_hol2(6,:))/0.16;
J_hol3(3:5,:) = J_hol(3:5,:);
dJ_holdq3(6) = (dJ_holdq2(7)-dJ_holdq2(5))/0.16;
dJ_holdq3(7) = (dJ_holdq2(4)-dJ_holdq2(6))/0.16;
dJ_holdq3(3:5) = dJ_holdq(3:5)';
%%


Aeq2 = [D2 -B2(:,[1:4 6:10]) -J_hol2';
    J_hol2 zeros(7,9+7)];
beq2 = [-C2;
    -dJ_holdq2];

Aeq = [D2 -B2(:,[1:4 6:10]) -J_hol';
    J_hol zeros(7,9+7)];
beq = [-C2;
    -dJ_holdq'];

Aeq3 = [D2 -B2(:,[1:4 6:10]) -J_hol3';
    J_hol3 zeros(7,9+7)];
beq3 = [-C2;
    -dJ_holdq3];
%%
clc;

options = optimoptions('quadprog');
options.Algorithm ="active-set"
%x y z pitch yaw
x0 = zeros(34,1);
[sol1,fval1]=  quadprog(G,g,[],[],Aeq,beq,[],[],x0,options);
ddq_sol1 = sol1(1:18);
u_sol1 = sol1(19:27)'
F_sol1 = sol1(28:end)'
jointLevel1  = J_hol'*F_sol1'

% two point contact
[sol2,fval2]=  quadprog(G,g,[],[],Aeq2,beq2,[],[],x0,options);
% [sol2,fval2]=  quadprog(G,g,Aub_fric,bub_fric,Aeq2,beq2,[],[],x0,options);
ddq_sol2 = sol2(1:18);
u_sol2 = sol2(19:27)'
F_sol2 = sol2(28:end)'
F = inv(J_hol2*D2*J_hol2')*(-dJ_holdq2 - J_hol2*inv(D2)*B2(:,[1:4 6:10])*u_sol2'+J_hol2*inv(D2)*C2)
H = [  1, 0, 0, 0, 0;
    0, 1, 0, 1, 0;
    0, 0, 1, 0, 1;
    0, 0, -0.08 , 0, 0.08;
    0, 0.08, 0, -0.08, 0];
Fsol_2_converted_toM = (H*F_sol2(3:end)')'
jointLevel2 = J_hol2'*F_sol2'

% diff of pitch and yaw using two point
[sol3,fval3]=  quadprog(G,g,[],[],Aeq3,beq3,[],[],x0,options);
% [sol2,fval2]=  quadprog(G,g,Aub_fric,bub_fric,Aeq2,beq2,[],[],x0,options);
ddq_sol3 = sol3(1:18);
u_sol3 = sol3(19:27)'
F_sol3 = sol3(28:end)'
jointLevel3 = J_hol3'*F_sol3'


%%
clc
[u_sol1; u_sol2; u_sol3]

F_sol2(3:end) = Fsol_2_converted_toM;
[F_sol1; F_sol2; F_sol3]


[jointLevel1'; jointLevel2'; jointLevel3']
